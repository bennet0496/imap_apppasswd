function a(A){rcmail.confirm_dialog(rcmail.gettext('confirm_delete_single','imap_apppasswd').replace('%password%',document.querySelector(`[data-apppw-id="${A}"] > * > .apppw_title_text`).textContent),'delete',(()=>rcmail.http_post('plugin.imap_apppasswd.remove',{'id':A})),{button_class:'delete'})}function b(){rcmail.http_post('plugin.imap_apppasswd.add')}function c(){rcmail.confirm_dialog(rcmail.gettext('confirm_delete_all','imap_apppasswd'),rcmail.gettext('delete_all','imap_apppasswd'),(()=>rcmail.http_post('plugin.imap_apppasswd.delete_all')),{button_class:'delete'})}function d(_){var B=document.querySelector(`[data-apppw-id="${_}"] .apppw_title .apppw_title_text`),C=document.querySelector(`[data-apppw-id="${_}"] .apppw_title .apppw_title_edit`);let D=document.createElement('input');D.value=B.innerText;D.id=`apppw_title_box_${_}`;D.className='apppw_title_box';D.type='text';B.replaceWith(D);D.focus();C.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"/></svg>';C.title=window.rcmail.gettext('done','imap_apppasswd');C.onclick=()=>rcmail.http_post('plugin.imap_apppasswd.rename',{'id':_,'name':D.value})}rcmail.addEventListener('plugin.imap_apppasswd.remove_from_list',function(_a){_a.id==='all'?document.querySelectorAll('[data-apppw-id]').forEach(e=>e.remove()):document.querySelector('[data-apppw-id="'+_a.id+'"]').remove();if(document.querySelector('.apppw_list > .apppw_entry')===null){var _b=document.querySelector('.apppw_list > .no_passwords');_b&&_b.classList.remove('hidden')}},!0);rcmail.addEventListener('plugin.imap_apppasswd.add',function(_A){var _B=document.querySelector('#new_entry_template').content.cloneNode(!0);_B.querySelector('input.apppw_password').value=_A.passwd;_B.querySelector('.apppw_entry').dataset.apppwId=_A.id;_B.querySelector('.apppw_content_action.toggle_vis').onclick=E=>{var aA=document.querySelector('[data-apppw-id=\''+_A.id+'\'] > * > input.apppw_password'),_C=E.target.nodeName==='svg'?E.target.parentNode:E.target;if(aA.type==='password'){aA.type='text';_C.innerHTML=document.querySelector('#symbol_hide').content.firstElementChild.outerHTML}else aA.type==='text'&&(aA.type='password',_C.innerHTML=document.querySelector('#symbol_show').content.firstElementChild.outerHTML)};_B.querySelector('.apppw_content_action.copy').onclick=_=>navigator.clipboard.writeText(_A.passwd).then(()=>window.rcmail.display_message(window.rcmail.gettext('copied','imap_apppasswd'))).catch(()=>window.rcmail.display_message(window.rcmail.gettext('copy_failed_check_perms','imap_apppasswd'),'error'));_B.querySelector('.apppw_delete').onclick=aB=>{aB.target.innerText=rcmail.gettext('delete','imap_apppasswd');document.querySelector('[data-apppw-id=\"'+_A.id+'\"] .apppw_content').remove();aB.target.onclick=()=>a(_A.id);var aC=document.querySelector('[data-apppw-id=\"'+_A.id+'\"] > * > .apppw_title_box').value;rcmail.http_post('plugin.imap_apppasswd.rename',{'id':_A.id,'name':aC})};_B.querySelector('.apppw_title_edit').onclick=()=>{var aD=document.querySelector('[data-apppw-id=\"'+_A.id+'\"] > * > .apppw_title_box').value;rcmail.http_post('plugin.imap_apppasswd.rename',{'id':_A.id,'name':aD})};document.getElementById('apppw_list').append(_B);var _c=document.querySelector('.apppw_list > .no_passwords');_c&&_c.classList.add('hidden')});rcmail.addEventListener('plugin.imap_apppasswd.renamed',function(aE){var aF=document.querySelector('[data-apppw-id="'+aE.id+'"] .apppw_title .apppw_title_box'),aG=document.querySelector('[data-apppw-id="'+aE.id+'"] .apppw_title .apppw_title_edit'),_d=document.createElement('span');_d.className='apppw_title_text';_d.innerText=aE.name;aF.replaceWith(_d);aG.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/></svg>';aG.onclick=()=>d(aE.id)});rcmail.addEventListener('init',function(aH){rcmail.register_command('plugin.imap_apppasswd.add',b,!0);rcmail.register_command('plugin.imap_apppasswd.remove_all',c,!0);(rcmail.task==='settings'&&rcmail.env.action==='plugin.imap_apppasswd.history')&&(rcmail.set_page_buttons(),rcmail.init_pagejumper('.pagenav > input'),rcmail.update_pagejumper(),rcmail.list_page=function(aI){if(aI==='next')aI=this.env.current_page+1;else if(aI==='last')aI=this.env.pagecount;else if(aI==='prev'&&this.env.current_page>1)aI=this.env.current_page-1;else if(aI==='first'&&this.env.current_page>1)aI=1;if(aI>0&&aI<=this.env.pagecount){this.env.current_page=aI;rcmail.goto_url('plugin.imap_apppasswd.history',{_pwid:rcmail.env.pwid,_page:aI})}})});window.addEventListener('load',function(aJ){for(const aL of document.querySelectorAll('span.apppw_lastused, span.apppw_created')){var aK=Date.parse(aL.title);!Number.isNaN(aK)&&(aL.title=new Date(aK).toLocaleString(void 0,{dateStyle:'full',timeStyle:'long'}))}document.querySelectorAll('td.timestamp').forEach(aM=>{var aN=Date.parse(aM.innerHTML);!Number.isNaN(aN)&&(aM.innerHTML=new Date(aN).toLocaleString(void 0,{dateStyle:'medium',timeStyle:'long'}))})});
